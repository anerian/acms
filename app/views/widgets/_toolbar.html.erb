<div id="toolbar">
  <ul><%= content %></ul>
</div>
<% content_for :foot do %>
<script type="text/javascript">
  var navItems = ['pages', 'links', 'media', 'appearance', 'tools', 'settings'];
  // controls for the toolbar
  $(document).ready(function () {
    for( var i = 0, len = navItems.length; i < len; ++i ) {
      var state = $.cookie(navItems[i]);
      //console.log("check: "+ navItems[i] + "=" + state);
      if( state == 'hidden' ) {
        //console.log("hide it");
        var icon = $("#toolbar ." + navItems[i] + "-icon");
        var h2 = icon.parents("h2");
        h2.next("ul").hide();
        h2.parent().removeClass("open");
      }
    }
    $("#toolbar h2 .handle").click(function(e) {
      e.preventDefault();
      var item = $(this).parents("h2").children(".micon").get(0);
      var options = { path: '/', expires: 10 };
      var itemName = null;

      for( var i = 0, len = navItems.length; i < len; ++i ) {
        if( item.className.match(navItems[i]) ) {
          itemName = navItems[i];
          break;
        }
      }
      var h2 = $(this).parents("h2");
      var ul = h2.next("ul");
      // show the line below the header right away
      if( ul.get(0).style.display == "none" ) {
        $.cookie(itemName, "visible", options);
        h2.parent().addClass("open");
      }
      ul.slideToggle("fast", function() {
        if( $(this).get(0).style.display == 'none' ) {
          // delay showing this line until the sub-menu is fully appeared
          $.cookie(itemName, "hidden", options);
          h2.parent().removeClass("open");
        }
      });
    });
  });
</script>
<% end %>
